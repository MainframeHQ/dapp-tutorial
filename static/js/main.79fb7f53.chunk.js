(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{202:function(e){e.exports=[{constant:!1,inputs:[],name:"renounceOwnership",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_newOwner",type:"address"}],name:"transferOwnership",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"previousOwner",type:"address"}],name:"OwnershipRenounced",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"previousOwner",type:"address"},{indexed:!0,name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{constant:!1,inputs:[{name:"name",type:"bytes32"}],name:"addCandidate",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getCandidateCount",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"index",type:"uint256"}],name:"getCandidateNameForIndex",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"registerVoter",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"getRegistrationCount",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"index",type:"uint256"}],name:"getRegistrationForIndex",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"voterAddr",type:"address"}],name:"approveRegistration",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"voterAddresses",type:"address[]"}],name:"approveRegistrations",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"voterAddr",type:"address"}],name:"voterIsRegistered",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"voterAddr",type:"address"}],name:"registrationIsApproved",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"voterAddr",type:"address"}],name:"voterHasVoted",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"name",type:"bytes32"}],name:"voteForCandidate",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"name",type:"bytes32"}],name:"getVoteCountForCandidate",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}]},213:function(e,t,n){e.exports=n(554)},218:function(e,t,n){},253:function(e,t){},255:function(e,t){},280:function(e,t){},323:function(e,t){},554:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(28),s=n.n(o),i=(n(218),n(212)),c=n(18),u=n.n(c),p=n(31),d=n(35),l=n(36),m=n(38),f=n(37),h=n(39),b=n(201),v=n.n(b),y=n(22),g=n.n(y),w=n(202),x=Object(a.createContext)({user:{},candidates:[],pendingVoters:[],vote:function(e){return null},approve:function(e){return null},requestApproval:function(e){return null}}),k=x.Provider,E=x.Consumer,C=function(e){return function(t){return r.a.createElement(E,null,function(n){return r.a.createElement(e,Object.assign({},t,n))})}},O=n(23),j=n(25),N=n.n(j),S=n(44),A=n.n(S),M=n(45),I=n.n(M),F=n(64),R=n.n(F),V=n(46),W=n.n(V),P=n(203),q=n.n(P),T=n(205),H=n.n(T),D=n(86),G=n.n(D),L=n(87),U=n.n(L),B=Object(O.withStyles)(function(e){return{badge:{top:10,right:"auto",left:0},candidate:{fontSize:16,padding:"10px 0 10px ".concat(4*e.spacing.unit,"px!important")},selected:{background:"yellow",color:"white"}}})(function(e){var t=e.classes,n=e.name,a=e.votes,o=e.onSelect,s=[];return e.selected&&s.push(t.selected),r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a,null),r.a.createElement(G.a,{role:void 0,dense:!0,button:!0,onClick:function(){return o(n)},className:s},r.a.createElement(H.a,{color:"primary",badgeContent:a,classes:{badge:t.badge}},r.a.createElement(U.a,{primary:n,className:t.candidate}))))}),J=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={candidate:""},n.selectCandidate=function(e){"approved"===n.props.user.registration&&!n.props.user.voted&&n.setState({candidate:e})},n.vote=function(){n.props.vote(n.state.candidate),n.setState({candidate:""})},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.classes,a=t.candidates,o=t.user;return r.a.createElement(A.a,{className:n.card},r.a.createElement(I.a,null,r.a.createElement(N.a,{variant:"h5",component:"h2",className:n.title},"Candidatos \xe0 presid\xeancia da rep\xfablica"),r.a.createElement(R.a,null,a.map(function(t,n){return r.a.createElement(B,{onSelect:e.selectCandidate,selected:!o.voted&&"approved"===o.registration&&e.state.candidate===t.name,key:"candidate-".concat(n),name:t.name,votes:t.votes})})),o.voted&&r.a.createElement(N.a,{variant:"h6",component:"h2",className:n.title},"Obrigado! Seu voto j\xe1 foi computado!"),"pendingApproval"===o.registration&&r.a.createElement(N.a,{variant:"h6",component:"h2",className:n.title},"Sua solicita\xe7\xe3o est\xe1 aguardando aprova\xe7\xe3o!")),"approved"===o.registration&&!o.voted&&r.a.createElement(W.a,{disabled:!this.state.candidate,variant:"contained",color:"primary",onClick:this.vote,className:n.button},"Votar"))}}]),t}(a.Component),z=C(Object(O.withStyles)(function(){return{title:{padding:"20px 0"},card:{marginTop:20,minWidth:275,width:"80vw"},button:{margin:"20px auto",display:"block"}}})(J)),$=n(211),_=n(206),K=n(207),Q=n.n(K),X=n(208),Y=n.n(X),Z=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={checked:[],name:""},n.toggleItem=function(e){-1!==n.state.checked.indexOf(e)?n.setState({checked:n.state.checked.filter(function(t){return t!==e})}):n.setState({checked:Object($.a)(n.state.checked).concat([e])})},n.approve=function(){n.props.batchApprove(n.state.checked),n.setState({checked:[]})},n.setName=function(e){n.setState({name:e.target.value})},n.registerCandidate=function(){n.props.addCandidate(n.state.name.substring(0,32)),n.setState({name:""})},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.classes,a=t.pendingVoters;return r.a.createElement(r.a.Fragment,null,r.a.createElement(A.a,{className:n.card},r.a.createElement(I.a,null,r.a.createElement(N.a,{variant:"h5",component:"h2",className:n.title},"Eleitores esperando aprova\xe7\xe3o."),r.a.createElement(R.a,null,a.map(function(t){return r.a.createElement(G.a,{key:t,role:void 0,dense:!0,button:!0,onClick:function(){return e.toggleItem(t)}},r.a.createElement(Q.a,{checked:-1!==e.state.checked.indexOf(t),tabIndex:-1,disableRipple:!0}),r.a.createElement(U.a,{primary:t}))})),r.a.createElement(W.a,{disabled:0===this.state.checked.length,variant:"contained",color:"primary",onClick:this.approve,className:n.button},"Aprovar"))),r.a.createElement(A.a,{className:n.card},r.a.createElement(I.a,null,r.a.createElement(N.a,{variant:"h5",component:"h2",className:n.title},"Cadastrar um candidato"),r.a.createElement(Y.a,{required:!0,onChange:this.setName,id:"outlined-required",label:"Nome do Candidato",className:n.textField,margin:"normal",variant:"outlined",value:this.state.name}),r.a.createElement(W.a,{disabled:0===this.state.name.length||Object(_.findIndex)(this.props.candidates,function(t){return t.name===e.state.name})>=0,variant:"contained",color:"primary",onClick:this.registerCandidate,className:n.button},"Salvar"))))}}]),t}(a.Component),ee=C(Object(O.withStyles)(function(){return{title:{padding:"20px 0"},card:{marginTop:20,minWidth:275,width:"80vw"},button:{margin:"20px auto",display:"block"},textField:{width:"100%"}}})(Z)),te=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.user;return"pendingRegistration"===n.registration?r.a.createElement(A.a,{className:t.card},r.a.createElement(I.a,null,r.a.createElement(N.a,{variant:"h5",component:"h2",className:t.title},"O seu endere\xe7o ETH \xe9: ",n.address),r.a.createElement(W.a,{variant:"contained",color:"primary",onClick:this.props.requestApproval,className:t.button},"Solicitar Acesso"))):null}}]),t}(a.Component),ne=C(Object(O.withStyles)(function(){return{title:{padding:"20px 0"},card:{marginTop:20,minWidth:275,width:"80vw"},button:{margin:"20px auto",display:"block"},textField:{width:"100%"}}})(te)),ae=n(209),re=n.n(ae),oe=n(210),se=n.n(oe),ie=Object(O.withStyles)(function(){return{bar:{height:70},grow:{flexGrow:1}}})(function(e){var t=e.classes;return r.a.createElement(re.a,{className:t.bar,position:"static"},r.a.createElement(se.a,null,r.a.createElement(N.a,{variant:"h6",color:"inherit",className:t.grow},"Mainframe MeetUp - Voting Dapp")))}),ce=Object(O.withStyles)(function(){return{error:{flexGrow:1,padding:20,color:"red",textAlign:"center"}}})(function(e){var t=e.classes,n=e.message;return r.a.createElement(N.a,{variant:"h6",color:"inherit",className:t.error},n)}),ue=C(Object(O.withStyles)(function(){return{root:{minHeight:"100vh",flex:1,flexGrow:1,background:"#d3d3d3"},main:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}}})(function(e){var t=e.classes,n=e.user;return r.a.createElement("div",{className:t.root},r.a.createElement(ie,null),r.a.createElement("div",{className:t.main},n.address?r.a.createElement(r.a.Fragment,null,r.a.createElement(z,null),r.a.createElement(ne,null),n.admin&&r.a.createElement(ee,null)):r.a.createElement(ce,{message:"Eita, parece que voc\xea n\xe3o tem o MetaMask instalado, ou n\xe3o est\xe1 conectado na rede correta."})))})),pe=function(e){function t(e){var n;Object(d.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).vote=function(){var e=Object(p.a)(u.a.mark(function e(t){var a,r,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.state.contract){e.next=3;break}return e.abrupt("return",new Error("Not connected to Web3"));case 3:return r=g.a.utf8ToHex(t),o=n.state.user.address,e.abrupt("return",new Promise(function(e,t){a.methods.voteForCandidate(r).send({from:o}).on("error",function(e){t(e)}).on("receipt",function(t){e(t)})}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.approve=function(){var e=Object(p.a)(u.a.mark(function e(t){var a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.state.contract){e.next=3;break}return e.abrupt("return",new Error("Not connected to Web3"));case 3:return r=n.state.user.address,e.abrupt("return",new Promise(function(e,n){a.methods.approveRegistration(t).send({from:r}).on("error",function(e){n(e)}).on("receipt",function(t){e(t)})}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.addCandidate=function(){var e=Object(p.a)(u.a.mark(function e(t){var a,r,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.state.contract){e.next=3;break}return e.abrupt("return",new Error("Not connected to Web3"));case 3:return r=g.a.utf8ToHex(t),o=n.state.user.address,e.abrupt("return",new Promise(function(e,t){a.methods.addCandidate(r).send({from:o}).on("error",function(e){t(e)}).on("receipt",function(t){e(t),n.getContractState()})}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.requestApproval=Object(p.a)(u.a.mark(function e(){var t,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.state.contract){e.next=3;break}return e.abrupt("return",new Error("Not connected to Web3"));case 3:return a=n.state.user.address,e.abrupt("return",new Promise(function(e,n){t.methods.registerVoter().send({from:a}).on("error",function(e){n(e)}).on("receipt",function(t){e(t)})}));case 5:case"end":return e.stop()}},e,this)})),n.batchApprove=function(){var e=Object(p.a)(u.a.mark(function e(t){var a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.state.contract){e.next=3;break}return e.abrupt("return",new Error("Not connected to Web3"));case 3:return r=n.state.user.address,e.abrupt("return",new Promise(function(e,n){a.methods.approveRegistrations(t).send({from:r}).on("error",function(e){n(e)}).on("receipt",function(t){e(t)})}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();var a={user:{},candidates:[],pendingVoters:[]};return window.web3&&(a.web3=new v.a(window.web3.currentProvider),a.contract=new a.web3.eth.Contract(w,"0x343fc71d8be1c399cb8aa9982cb37d3c32f1571e")),n.state=a,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(p.a)(u.a.mark(function e(){var t=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.getContractState(),this.timeout=setInterval(function(){return t.getContractState()},2e3);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.timeout&&this.timeout()}},{key:"getContractState",value:function(){var e=Object(p.a)(u.a.mark(function e(){var t,n,a,r,o,s,i,c,p,d;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,n=t.web3,a=t.contract,!n||!a){e.next=35;break}return e.prev=2,e.next=5,n.eth.getCoinbase();case 5:return r=e.sent,e.next=8,a.methods.voterIsRegistered(r).call();case 8:return o=e.sent,e.next=11,a.methods.owner().call();case 11:if(s=e.sent,i={registration:o?"pendingApproval":"pendingRegistration",admin:s.toLowerCase()===r.toLowerCase(),address:r.toLowerCase()},!o){e.next=23;break}return e.next=16,a.methods.registrationIsApproved(r).call();case 16:if(!e.sent){e.next=23;break}return i.registration="approved",e.next=21,a.methods.voterHasVoted(r).call();case 21:c=e.sent,i.voted=c;case 23:return e.next=25,this.fetchCandidates(this.state.contract);case 25:return p=e.sent,e.next=28,this.fetchPendingVoters();case 28:d=e.sent,this.setState({pendingVoters:d,candidates:p,user:i}),e.next=35;break;case 32:e.prev=32,e.t0=e.catch(2),console.warn("err: ",e.t0);case 35:case"end":return e.stop()}},e,this,[[2,32]])}));return function(){return e.apply(this,arguments)}}()},{key:"fetchCandidates",value:function(){var e=Object(p.a)(u.a.mark(function e(){var t,n,a,r,o,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.contract,n=[],e.next=4,t.methods.getCandidateCount().call();case 4:a=e.sent,r=0;case 6:if(!(r<a)){e.next=17;break}return e.next=9,t.methods.getCandidateNameForIndex(r).call();case 9:return o=e.sent,e.next=12,t.methods.getVoteCountForCandidate(o).call();case 12:s=e.sent,n.push({name:g.a.hexToUtf8(o),votes:s});case 14:r++,e.next=6;break;case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fetchPendingVoters",value:function(){var e=Object(p.a)(u.a.mark(function e(){var t,n,a,r,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.contract,n=[],e.next=4,t.methods.getRegistrationCount().call();case 4:a=e.sent,r=0;case 6:if(!(r<a)){e.next=17;break}return e.next=9,t.methods.getRegistrationForIndex(r).call();case 9:return o=e.sent,e.next=12,t.methods.registrationIsApproved(o).call();case 12:e.sent||n.push(o);case 14:r++,e.next=6;break;case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.web3?r.a.createElement(k,{value:Object(i.a)({vote:this.vote,approve:this.approve,requestApproval:this.requestApproval,addCandidate:this.addCandidate,batchApprove:this.batchApprove},this.state)},r.a.createElement(ue,null)):r.a.createElement("span",null,"Please install metamask to use this app.")}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(pe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[213,2,1]]]);
//# sourceMappingURL=main.79fb7f53.chunk.js.map